<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dive Grades</title>
    <!-- Link to your CSS file -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function getGradeColor(gradeValue) {
            // Ensure gradeValue is within the expected range
            gradeValue = Math.max(5, Math.min(9, gradeValue));
            // Normalize the value between 5 and 9
            const normalizedValue = (gradeValue - 5) / 4;
            // Interpolate between red and green
            const redComponent = Math.round((1 - normalizedValue) * 255);
            const greenComponent = Math.round(normalizedValue * 255);
            return `rgb(${redComponent}, ${greenComponent}, 0)`;
        }
        

        $(document).ready(function() {
            $('#diverForm').submit(function(e) {
                e.preventDefault();
                $('#loadingIndicator').show(); // Show the loading indicator
        
                var diverName = $('#diverName').val();
                $.ajax({
                    type: "POST",
                    url: "/get-grades",
                    data: { diver_name: diverName },
                    success: function(data) {
                        $('#loadingIndicator').hide(); // Hide the loading indicator
                        if (data.rankings) {
                            const overallGrade = data.rankings.overall_average_grade || 'No overall grade available';
                            const overallGradeColor = getGradeColor(parseFloat(overallGrade));
                            $('#overallGrade').html(
                                '<span class="grade-value" style="color:' + overallGradeColor + ';">' + overallGrade + '</span>'
                            );
        
                            ['1 Meter', '3 Meter', 'Platform'].forEach(function(event) {
                                const grade = data.rankings[event]?.average_grade || 'No grade available';
                                const gradeColor = getGradeColor(parseFloat(grade));
                                $('#' + event.replace(' ', '') + 'Grade').html(
                                    '<span class="grade-value" style="color:' + gradeColor + ';">' + grade + '</span>'
                                );
                            });
        
                            $('#rankingTitle').text('Ranking for ' + diverName);
                        } else {
                            $('#overallGrade').text('No grades available');
                            $('.event-grade').empty(); // Clear event grades
                        }
                    },
                    error: function(response) {
                        $('#loadingIndicator').hide(); // Hide the loading indicator
                        $('#overallGrade').text('Diver not found');
                        $('.event-grade').empty(); // Clear event grades
                    }
                });
            });
        });        
    </script>
</head>
<body>
    <!-- New title for the input -->
    <div class="input-diver-title">Input Diver</div>


    <!-- Diver input form -->
    <form id="diverForm">
        <input type="text" id="diverName" name="diver_name" placeholder="Enter Diver's Name">
        <button type="submit">Get Grades</button>
    </form>

    <!-- Ranking section -->
    <div class="title" id="rankingTitle">Rankings for...</div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" style="display: none;">Loading...</div>

    <!-- Overall grade and event grades -->

    <div class="grade-container">
        <div class="grade-label-container">
            <span class="grade-label">Grade</span>
            <div id="overallGrade" class="overall-grade grade"></div>
        </div>
        <div class="grade-label-container">
            <span class="grade-label">1 Meter</span>
            <div id="1MeterGrade" class="event-grade grade"></div>
        </div>
        <div class="grade-label-container">
            <span class="grade-label">3 Meter</span>
            <div id="3MeterGrade" class="event-grade grade"></div>
        </div>
        <div class="grade-label-container">
            <span class="grade-label">Platform</span>
            <div id="PlatformGrade" class="event-grade grade"></div>
        </div>
    </div>
    

</body>
</html>
